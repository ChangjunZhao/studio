# 复制企微回调地址功能指南

## 功能概述

新增的"复制企微回调地址"功能让您可以快速获取并复制企业微信应用的回调地址，简化企业微信后台的配置过程。

## 如何使用

### 1. 访问连接管理页面
在浏览器中访问：`http://localhost:9002/connections`

### 2. 找到目标连接
在连接列表中找到您要配置的企业微信应用。

### 3. 打开操作菜单
点击连接行最右侧的"⋯"（更多操作）按钮。

### 4. 选择复制功能
在下拉菜单中点击"📋 复制企微回调地址"。

### 5. 查看回调信息
弹出的对话框将显示：
- **应用信息**：应用名称、企业ID、应用ID
- **回调地址**：自动生成的完整回调地址
- **配置说明**：详细的配置步骤

### 6. 复制地址
点击回调地址输入框右侧的复制图标📋，地址将自动复制到剪贴板。

## 回调地址格式

生成的回调地址格式为：
```
{protocol}://{host}/api/weixin/callback/{corpId}/{agentId}
```

### 示例
- 开发环境：`http://localhost:9002/api/weixin/callback/ww819076ca8be84cff/1000104`
- 生产环境：`https://api.example.com/api/weixin/callback/ww819076ca8be84cff/1000104`

## 在企业微信后台配置

1. 登录企业微信管理后台
2. 进入目标应用的设置页面
3. 找到"接收消息"设置
4. 点击"设置API接收"
5. 在"URL"字段粘贴复制的回调地址
6. 配置Token和EncodingAESKey（与系统中保存的一致）
7. 点击保存

## 注意事项

### 域名要求
- 开发环境：可以使用 `localhost` 或 `127.0.0.1`
- 生产环境：必须使用公网可访问的域名
- 必须支持HTTPS（生产环境）

### 配置一致性
确保企业微信后台配置的Token和EncodingAESKey与系统中的设置完全一致。

### 测试验证
配置完成后，企业微信会自动发送验证请求。如果配置正确，应该显示"保存成功"。

## 故障排除

### 验证失败
- 检查回调地址是否正确
- 确认Token和EncodingAESKey是否匹配
- 验证服务器是否可公网访问

### 地址不正确
- 确保应用正在正确的域名和端口上运行
- 检查企业ID和应用ID是否正确

### 复制功能不工作
- 确保浏览器支持剪贴板API
- 尝试手动选择并复制地址

## 技术实现

该功能基于以下技术：
- **前端**：React + TypeScript
- **UI组件**：Radix UI Dialog 和 Input 组件
- **复制功能**：Navigator Clipboard API
- **Toast通知**：shadcn/ui Toast 组件

## 更新日志

### v1.0.0
- ✅ 新增复制企微回调地址功能
- ✅ 智能回调地址生成
- ✅ 用户友好的配置指南
- ✅ 一键复制到剪贴板
- ✅ 应用信息展示 